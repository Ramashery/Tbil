<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Firebase Connection Test</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; padding: 20px; line-height: 1.6; background-color: #f4f4f9; color: #333; }
        .container { max-width: 800px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #1a73e8; }
        #result { border: 1px solid #ccc; padding: 15px; margin-top: 20px; border-radius: 5px; background: #fafafa; }
        .error { color: #d93025; font-weight: bold; }
        .success { color: #1e8e3e; font-weight: bold; }
        pre { background: #eee; padding: 10px; border-radius: 4px; white-space: pre-wrap; word-wrap: break-word; }
        ul { padding-left: 20px; }
        li { margin-bottom: 5px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Проверка подключения к Firebase</h1>
        <p>Эта страница пытается выполнить одно простое действие: прочитать данные из вашей коллекции 'rooms'.</p>

        <div id="result">
            <p><strong>Статус:</strong> Ожидание ответа от базы данных...</p>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firestore-compat.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // ВАШ УНИКАЛЬНЫЙ КОНФИГУРАЦИОННЫЙ ОБЪЕКТ FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyCZZ7kICCJMcWAjW5bnf_-vsH2s-KoZrSs",
            authDomain: "tbil-home.firebaseapp.com",
            projectId: "tbil-home",
            storageBucket: "tbil-home.firebasestorage.app",
            messagingSenderId: "849747940427",
            appId: "1:849747940427:web:bd3744d816a25e62c7e9ce",
            measurementId: "G-7YWSRMGV33"
        };

        // Инициализация Firebase
        const resultDiv = document.getElementById('result');
        try {
            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();

            // Пытаемся прочитать коллекцию 'rooms'
            db.collection('rooms').get()
                .then((querySnapshot) => {
                    if (querySnapshot.empty) {
                        resultDiv.innerHTML = '<p class="success">УСПЕХ! Подключение к базе данных есть, но коллекция "rooms" пуста.</p>';
                        return;
                    }
                    
                    let html = '<p class="success">УСПЕХ! Подключение есть. Найденные номера:</p><ul>';
                    querySnapshot.forEach((doc) => {
                        const room = doc.data();
                        html += `<li>${room.title || 'Номер без названия'} (ID: ${doc.id})</li>`;
                    });
                    html += '</ul>';
                    resultDiv.innerHTML = html;
                })
                .catch((error) => {
                    // Эта часть самая важная! Она покажет нам ошибку.
                    console.error("Ошибка при чтении из Firestore: ", error);
                    resultDiv.innerHTML = `
                        <p class="error">ОШИБКА ПОДКЛЮЧЕНИЯ!</p>
                        <p>Не удалось прочитать данные из базы. Это может быть из-за правил безопасности Firestore или ошибки в конфигурации. Вот текст ошибки:</p>
                        <pre>${error.toString()}</pre>
                    `;
                });

        } catch (e) {
            console.error("Критическая ошибка инициализации Firebase: ", e);
            resultDiv.innerHTML = `
                <p class="error">КРИТИЧЕСКАЯ ОШИБКА ИНИЦИАЛИЗАЦИИ!</p>
                <p>Ваш объект 'firebaseConfig' содержит ошибку или не может быть обработан. Проверьте его еще раз в консоли Firebase.</p>
                <pre>${e.toString()}</pre>
            `;
        }
    });
    </script>

</body>
</html>